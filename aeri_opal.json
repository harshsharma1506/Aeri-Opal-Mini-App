{
  "metadata": {
    "visual": {
      "presentation": {
        "themes": {
          "43dfbaf0-c655-4051-962a-2fead025fad0": {
            "template": "basic",
            "templateAdditionalOptions": {},
            "palette": {
              "primary": {
                "0": "#000000",
                "5": "#1c0e00",
                "10": "#2a1700",
                "15": "#382100",
                "20": "#462a00",
                "25": "#553400",
                "30": "#653e00",
                "35": "#744900",
                "40": "#855400",
                "50": "#a66a00",
                "60": "#c6821b",
                "70": "#e49c36",
                "80": "#ffb95d",
                "90": "#ffddb7",
                "95": "#ffeede",
                "98": "#fff8f4",
                "99": "#fffbff",
                "100": "#ffffff"
              },
              "secondary": {
                "0": "#000000",
                "5": "#1c0e00",
                "10": "#281805",
                "15": "#33230d",
                "20": "#3f2d17",
                "25": "#4b3821",
                "30": "#57432b",
                "35": "#644f36",
                "40": "#705b41",
                "50": "#8b7357",
                "60": "#a68c6f",
                "70": "#c2a788",
                "80": "#dfc2a2",
                "90": "#fcddbc",
                "95": "#ffeede",
                "98": "#fff8f4",
                "99": "#fffbff",
                "100": "#ffffff"
              },
              "tertiary": "",
              "error": {
                "0": "#000000",
                "5": "#2d0001",
                "10": "#410002",
                "15": "#540003",
                "20": "#690005",
                "25": "#7e0007",
                "30": "#93000a",
                "35": "#a80710",
                "40": "#ba1a1a",
                "50": "#de3730",
                "60": "#ff5449",
                "70": "#ff897d",
                "80": "#ffb4ab",
                "90": "#ffdad6",
                "95": "#ffedea",
                "98": "#fff8f7",
                "99": "#fffbff",
                "100": "#ffffff"
              },
              "neutral": {
                "0": "#000000",
                "5": "#14100c",
                "10": "#1f1b16",
                "15": "#2a2520",
                "20": "#352f2a",
                "25": "#403a35",
                "30": "#4c4640",
                "35": "#58514b",
                "40": "#645d57",
                "50": "#7d766f",
                "60": "#978f88",
                "70": "#b2aaa2",
                "80": "#cec5bd",
                "90": "#ebe1d9",
                "95": "#f9efe7",
                "98": "#fff8f4",
                "99": "#fffbff",
                "100": "#ffffff"
              },
              "neutralVariant": {
                "0": "#000000",
                "5": "#171007",
                "10": "#221a10",
                "15": "#2d241a",
                "20": "#382f24",
                "25": "#443a2f",
                "30": "#504539",
                "35": "#5c5144",
                "40": "#685c50",
                "50": "#827568",
                "60": "#9c8e80",
                "70": "#b8a99a",
                "80": "#d4c4b5",
                "90": "#f0e0d0",
                "95": "#ffeede",
                "98": "#fff8f4",
                "99": "#fffbff",
                "100": "#ffffff"
              }
            },
            "themeColors": {
              "primaryColor": "",
              "secondaryColor": "",
              "backgroundColor": "",
              "primaryTextColor": "",
              "textColor": ""
            },
            "splashScreen": {
              "storedData": {
                "handle": "drive:/1D32V0-Rb9GquaKHS18Ij57JBrwPnLLw_",
                "mimeType": "image/png",
                "contentLength": 1638052
              }
            }
          },
          "a208a7dd-ac4e-4da5-b605-3c413a2ebc77": {
            "template": "basic",
            "templateAdditionalOptions": {},
            "palette": {
              "primary": {
                "0": "#000000",
                "5": "#00102c",
                "10": "#001a40",
                "15": "#002454",
                "20": "#002f68",
                "25": "#00397d",
                "30": "#0b458e",
                "35": "#1f519b",
                "40": "#2f5da8",
                "50": "#4b76c2",
                "60": "#6690de",
                "70": "#81abfb",
                "80": "#acc7ff",
                "90": "#d7e2ff",
                "95": "#edf0ff",
                "98": "#f9f9ff",
                "99": "#fefbff",
                "100": "#ffffff"
              },
              "secondary": {
                "0": "#000000",
                "5": "#081120",
                "10": "#131c2c",
                "15": "#1e2636",
                "20": "#283041",
                "25": "#333b4d",
                "30": "#3f4759",
                "35": "#4a5265",
                "40": "#565e71",
                "50": "#6f778b",
                "60": "#8991a5",
                "70": "#a3abc0",
                "80": "#bec6dc",
                "90": "#dae2f9",
                "95": "#edf0ff",
                "98": "#f9f9ff",
                "99": "#fefbff",
                "100": "#ffffff"
              },
              "tertiary": "",
              "error": {
                "0": "#000000",
                "5": "#2d0001",
                "10": "#410002",
                "15": "#540003",
                "20": "#690005",
                "25": "#7e0007",
                "30": "#93000a",
                "35": "#a80710",
                "40": "#ba1a1a",
                "50": "#de3730",
                "60": "#ff5449",
                "70": "#ff897d",
                "80": "#ffb4ab",
                "90": "#ffdad6",
                "95": "#ffedea",
                "98": "#fff8f7",
                "99": "#fffbff",
                "100": "#ffffff"
              },
              "neutral": {
                "0": "#000000",
                "5": "#101114",
                "10": "#1b1b1f",
                "15": "#252629",
                "20": "#2f3033",
                "25": "#3b3b3f",
                "30": "#46464a",
                "35": "#525256",
                "40": "#5e5e62",
                "50": "#77777a",
                "60": "#919094",
                "70": "#ababaf",
                "80": "#c7c6ca",
                "90": "#e3e2e6",
                "95": "#f2f0f4",
                "98": "#faf9fd",
                "99": "#fefbff",
                "100": "#ffffff"
              },
              "neutralVariant": {
                "0": "#000000",
                "5": "#0e1118",
                "10": "#191c22",
                "15": "#23262d",
                "20": "#2d3038",
                "25": "#383b43",
                "30": "#44474f",
                "35": "#50525a",
                "40": "#5c5e66",
                "50": "#74777f",
                "60": "#8e9099",
                "70": "#a9abb4",
                "80": "#c4c6d0",
                "90": "#e1e2ec",
                "95": "#eff0fa",
                "98": "#f9f9ff",
                "99": "#fefbff",
                "100": "#ffffff"
              }
            },
            "themeColors": {
              "primaryColor": "",
              "secondaryColor": "",
              "backgroundColor": "",
              "primaryTextColor": "",
              "textColor": ""
            },
            "splashScreen": {
              "storedData": {
                "handle": "drive:/1dfM4AQ6zcZIkK-ES0oPJKsylxmnctJb2",
                "mimeType": "image/png",
                "contentLength": 1457224
              }
            }
          },
          "b31f8649-983b-4b70-8f3c-bedff0ab45b2": {
            "template": "basic",
            "templateAdditionalOptions": {},
            "palette": {
              "primary": {
                "0": "#000000",
                "5": "#1d0d00",
                "10": "#2c1700",
                "15": "#3a2000",
                "20": "#482900",
                "25": "#583300",
                "30": "#673d00",
                "35": "#784700",
                "40": "#885200",
                "50": "#ab6800",
                "60": "#c98021",
                "70": "#e89a3b",
                "80": "#ffb869",
                "90": "#ffdcbb",
                "95": "#ffeee0",
                "98": "#fff8f4",
                "99": "#fffbff",
                "100": "#ffffff"
              },
              "secondary": {
                "0": "#000000",
                "5": "#1c0e01",
                "10": "#281805",
                "15": "#34220e",
                "20": "#402d17",
                "25": "#4c3721",
                "30": "#58432c",
                "35": "#654e36",
                "40": "#725a41",
                "50": "#8c7258",
                "60": "#a78c70",
                "70": "#c3a689",
                "80": "#e0c1a3",
                "90": "#feddbd",
                "95": "#ffeee0",
                "98": "#fff8f4",
                "99": "#fffbff",
                "100": "#ffffff"
              },
              "tertiary": "",
              "error": {
                "0": "#000000",
                "5": "#2d0001",
                "10": "#410002",
                "15": "#540003",
                "20": "#690005",
                "25": "#7e0007",
                "30": "#93000a",
                "35": "#a80710",
                "40": "#ba1a1a",
                "50": "#de3730",
                "60": "#ff5449",
                "70": "#ff897d",
                "80": "#ffb4ab",
                "90": "#ffdad6",
                "95": "#ffedea",
                "98": "#fff8f7",
                "99": "#fffbff",
                "100": "#ffffff"
              },
              "neutral": {
                "0": "#000000",
                "5": "#14100c",
                "10": "#1f1b16",
                "15": "#2a2520",
                "20": "#352f2b",
                "25": "#403a35",
                "30": "#4c4640",
                "35": "#58514c",
                "40": "#645d57",
                "50": "#7d7670",
                "60": "#988f89",
                "70": "#b3aaa3",
                "80": "#cfc5be",
                "90": "#ebe1d9",
                "95": "#faefe7",
                "98": "#fff8f4",
                "99": "#fffbff",
                "100": "#ffffff"
              },
              "neutralVariant": {
                "0": "#000000",
                "5": "#170f07",
                "10": "#231a11",
                "15": "#2e241a",
                "20": "#392f24",
                "25": "#44392f",
                "30": "#50453a",
                "35": "#5c5045",
                "40": "#695c50",
                "50": "#827568",
                "60": "#9d8e81",
                "70": "#b8a89b",
                "80": "#d4c4b5",
                "90": "#f1dfd0",
                "95": "#ffeee0",
                "98": "#fff8f4",
                "99": "#fffbff",
                "100": "#ffffff"
              }
            },
            "themeColors": {
              "primaryColor": "",
              "secondaryColor": "",
              "backgroundColor": "",
              "primaryTextColor": "",
              "textColor": ""
            },
            "splashScreen": {
              "storedData": {
                "handle": "drive:/1ZJ-D77rfCrLaK9dHE1wog5hdL05HWqYU",
                "mimeType": "image/png",
                "contentLength": 1843976
              }
            }
          }
        },
        "theme": "b31f8649-983b-4b70-8f3c-bedff0ab45b2"
      }
    },
    "intent": "Please build this app - call it Aeri  following are your instruction - üß† GLOBAL SYSTEM INSTRUCTION (Use in All Gemini Nodes)\n\nAdd this as a base instruction where possible:\n\nThis application supports emotional regulation through reflection and guided meditation.\nIt is not therapy and must not provide medical advice.\nTone must always be calm, grounded, non-judgmental, and secular.\nIf user input indicates self-harm or crisis intent, set risk_flag accordingly and avoid generating meditation.\n\n1Ô∏è‚É£ NODE: Mood Classification Engine\nSystem Prompt\nYou are an emotional classification engine.\n\nAnalyze the user's input and return ONLY valid JSON.\n\nDo not include explanations.\n\nReturn this structure exactly:\n\n{\n  \"mood_label\": \"\",\n  \"trigger\": \"\",\n  \"emotional_tone\": \"\",\n  \"intensity_inferred\": 1-10,\n  \"risk_flag\": \"none | self_harm | crisis\"\n}\n\nRules:\n- mood_label must be 1‚Äì3 words.\n- trigger must summarize root cause in under 8 words.\n- emotional_tone describes internal pattern (e.g., self-critical, pressured, restless).\n- intensity_inferred must consider text and slider input.\n- If user expresses desire to harm themselves, set risk_flag = self_harm.\n- If user expresses urgent suicidal intent, set risk_flag = crisis.\n- If no risk detected, risk_flag = none.\n\nReturn only JSON.\n\nInput Variables Passed from Opal:\n\nmood_chip\n\nslider_intensity\n\nuser_text\n\n2Ô∏è‚É£ NODE: Reflection Question Generator\nSystem Prompt\nGenerate exactly 2 reflective questions.\n\nContext:\nMood: {mood_label}\nTrigger: {trigger}\nTone: {emotional_tone}\n\nRules:\n- Each question under 20 words.\n- Neutral and non-judgmental.\n- Encourage awareness, not advice.\n- No therapy terminology.\n- No spiritual language.\n- No motivational tone.\n\nOutput format:\n\n1. \n2.\n\n3Ô∏è‚É£ NODE: Meditation Generator (Core Engine)\nSystem Prompt\nYou are a professional secular meditation guide.\n\nCreate a 5-minute guided meditation.\n\nContext:\nMood: {mood_label}\nTrigger: {trigger}\nTone: {emotional_tone}\nUser Personalization Profile: {customization_profile}\n\nSTRICT STRUCTURE:\n\n1. Arrival and grounding\n2. Body awareness\n3. Breath focus\n4. Emotional acknowledgment\n5. Gentle reframing\n6. Closure and return to task\n\nRequirements:\n- 600‚Äì700 words maximum.\n- Tone: calm, warm, grounded.\n- No religion.\n- No philosophy.\n- No therapy jargon.\n- Do not analyze the user.\n- Do not give advice.\n- Do not mention psychology terms.\n- Include [pause 4 seconds] every 2‚Äì3 sentences.\n- If personalization profile suggests preferences, adapt tone and pacing naturally.\n- Keep language simple and human.\n\nOutput meditation script only.\n\n4Ô∏è‚É£ NODE: Post-Session Feedback Analyzer\n\nAfter user selects:\n\nVery helpful\n\nHelpful\n\nNeutral\n\nNot helpful\n\nIf NOT helpful ‚Üí run this node.\n\nSystem Prompt\nUser feedback: {feedback_rating}\nUser optional comment: {feedback_text}\n\nGenerate:\n1 short clarifying question under 15 words.\n\nPurpose:\nUnderstand why the meditation was not helpful.\n\nKeep tone neutral and calm.\nNo defensive language.\nNo therapy tone.\n\n5Ô∏è‚É£ NODE: AI Personalization Engine (Fully AI-Inferred)\n\nThis is critical.\n\nEvery session, after feedback, update user profile.\n\nSystem Prompt\nYou are updating a user's meditation personalization profile.\n\nPrevious profile:\n{customization_profile}\n\nCurrent session data:\nMood: {mood_label}\nTrigger: {trigger}\nFeedback rating: {feedback_rating}\nFeedback explanation: {feedback_text}\n\nUpdate the profile to better tailor future meditations.\n\nReturn ONLY valid JSON in this format:\n\n{\n  \"tone_preference\": \"direct | warm | softer\",\n  \"intro_length\": \"short | medium | long\",\n  \"body_focus\": \"minimal | balanced | extended\",\n  \"breath_focus\": \"minimal | balanced | extended\",\n  \"pacing\": \"slower | balanced | slightly_faster\",\n  \"notes\": \"short summary under 20 words\"\n}\n\nRules:\n- Infer gently from feedback.\n- Do not overcorrect from one session.\n- Evolve gradually.\n- If insufficient feedback, retain previous settings.\n- Keep adjustments subtle.\n- Return only JSON.\n\n\nThis is where the system becomes intelligent.\n\n6Ô∏è‚É£ NODE: Safety Intervention Script\n\nTriggered if risk_flag != none\n\nSystem Prompt\nUser input indicates potential self-harm or crisis.\n\nGenerate a short supportive message.\n\nRules:\n- Be compassionate.\n- Encourage seeking real human support.\n- Do not provide advice.\n- Do not minimize their feelings.\n- Do not generate meditation.\n- Keep under 120 words.\n\n\nThen manually append crisis resources in UI.\n\nüß© FINAL OPAL NODE ORDER\n\nLogin (Google handled by Opal)\n\nMood Input\n\nTranscription\n\nMood Classification\n\nSafety Check Branch\n\nReflection Generator\n\nMeditation Generator\n\nTTS (optional)\n\nPost Mood Check\n\nFeedback Analyzer\n\nPersonalization Engine\n\nStore Data\n\nUpdate Dashboard\n\nüìä Dashboard V1 Metrics\n\nDisplay:\n\nTotal Sessions\n\nAvg Mood Improvement\n\nMost Frequent Mood\n\nThis Week Usage Count\n\nSimple.\n\nüöÄ V1 IS NOW LOCKED\n\nYou now have:\n\n‚úî Clean architecture\n‚úî AI-driven personalization\n‚úî Structured prompts\n‚úî Safety logic\n‚úî Dashboard\n‚úî Adaptive evolution",
    "revision_intents": [
      "Redesign Aeri with a warm and earthy aesthetic.\nUse warm linen background (#F3EFE7) and soft sand surfaces (#E7DFD2).\nPrimary accent muted olive (#8C9A7A).\nRemove all saturated blues and 3D illustrations.\nTypography: serif headline (Cormorant Garamond), clean sans body.\nLarge spaced ‚ÄúAERI‚Äù on landing with poetic line (‚ÄúTake a moment to return.‚Äù).\nRounded corners minimum 20px.\nMeditation screen must be immersive: large timer, breathing animation, transcript hidden by default.\nDesign must feel grounded, calm, and human ‚Äî not SaaS or corporate.",
      "üéôÔ∏è VOICE + AMBIENT AUDIO GENERATION SPEC\n\nAfter generating the guided meditation script, produce a single audio output that includes:\n\nA human-like voice narration.\n\nA constant, subtle ambient background sound throughout the entire session.\n\nThe final output must feel immersive, calm, and emotionally safe.\n\nüó£Ô∏è Voice Requirements\n\nVoice must:\n\nSound natural and human-like (not robotic).\n\nBe warm, grounded, and emotionally present.\n\nMaintain soft, steady pacing (~120‚Äì130 words per minute).\n\nInclude natural micro-pauses between phrases.\n\nSlightly soften tone at sentence endings.\n\nAvoid overly dramatic emphasis.\n\nAvoid overly cheerful tone.\n\nAvoid monotone delivery.\n\nInsert natural breathing pauses where indicated in script.\nRespect line breaks and pause markers (‚Äú‚Ä¶‚Äù or [pause 4 seconds]).\n\nüéµ Background Ambient Layer\n\nAdd a continuous soft ambient layer underneath narration.\n\nRequirements:\n\nVery subtle volume (20‚Äì30% of voice level).\n\nNo melody dominance.\n\nNo rhythmic beats.\n\nNo sharp frequencies.\n\nNo sudden changes.\n\nNo crescendos.\n\nAcceptable ambient styles:\n\nSoft atmospheric pad\n\nWarm low-frequency hum\n\nLight wind texture\n\nVery subtle nature ambience (distant air, soft rustle)\n\nMust loop seamlessly.\nMust remain constant throughout entire meditation.\n\nüîä Audio Mixing Rules\n\nVoice must remain clearly dominant.\n\nAmbient sound must never overpower narration.\n\nFade in ambient layer gently during first 3 seconds.\n\nFade out both voice and ambient during final 2 seconds.\n\nNo abrupt cutoffs.\n\nFinal audio must feel cohesive ‚Äî not layered artificially.\n\nüéöÔ∏è Emotional Tone Direction\n\nThe delivery should feel like:\n\nSomeone sitting beside you.\n\nCalm, unhurried presence.\n\nTrustworthy.\n\nSoftly grounding.\n\nNot:\n\nCorporate narration.\n\nTherapy session.\n\nASMR whisper.\n\nYouTube meditation influencer.\n\nüéß Output Format\n\nGenerate a single merged audio file:\n\nDuration synced to script pacing.\n\nHigh clarity voice.\n\nSubtle ambient background embedded.\n\nAudio must align with session timer duration.",
      "üéµ Ambient Audio Rules\n\nPlay a single looping ambient track during the session.\n\nRequirements:\n\nVery soft.\n\nNo melody dominance.\n\nNo beats.\n\nNo sudden shifts.\n\nLoop seamlessly.\n\nFade in over 3 seconds.\n\nFade out gently when timer ends.\n\nVolume:\n~25% default.\n\nInclude:\n\nVolume slider (small, subtle).\n\nMute option. - use the native ",
      "Warm earthy ambient soundscape.\nSoft atmospheric pad with low warm drone.\nGentle airy texture in the background.\nMinimal harmonic movement.\nCalm, grounded, spacious mood.\nSlow evolving tones.\nNo percussion.\nNo rhythmic beats.\nNo strong melody.\nMeditative and emotionally safe atmosphere.  - use this prompt for Lyra",
      "Refactor the ambient audio player so that:\n\nThe <audio> element is mounted only once.\n\nIt is controlled via a persistent reference.\n\nIt is not recreated during state updates.\n\nTimer updates must not cause audio re-render.\n\nEnsure loop works correctly.\n\nHandle play() promise to avoid silent failures.\n\nAdd graceful error logging if playback fails. efactor meditation session so ambient audio:\n\nIs initialized once at session start.\n\nIs not tied to timer state updates.\n\nIs not conditionally rendered.\n\nContinues playing even if UI updates.\n\nDoes not reload source during session.\n\nIf timer updates cause re-render, isolate timer from audio logic.\n\nAudio must remain stable throughout session.",
      "üîß Audio System Stabilization ‚Äì Ambient + Voice\n\nThere are currently two issues in the meditation session:\n\nAmbient sound does not run continuously.\n\nVoiceover stops after ~10‚Äì12 seconds.\n\nRefactor the audio system to prioritize stability and reliability over feature complexity.\n\nüéµ Issue 1: Ambient Sound Not Running Continuously\n\nPossible causes:\n\nGenerated ambient file too short.\n\nLoop not properly enabled.\n\nAudio element re-rendering.\n\nAudio source resetting during UI updates.\n\nRequired Fix:\n\nImplement one of the following stable solutions:\n\nPreferred Solution (MVP Stable Mode)\n\nGenerate a single 5-minute ambient meditation track.\n\nStore it as a static session background track.\n\nEnable seamless looping.\n\nMount audio element once at session start.\n\nDo not regenerate ambient per session.\n\nDo not re-render or reset the audio source during timer updates.\n\nAmbient should:\n\nFade in gently at start (2‚Äì3 seconds).\n\nPlay continuously throughout session.\n\nFade out at session end.\n\nüéô Issue 2: Voiceover Stops After 10‚Äì12 Seconds\n\nThis is likely due to:\n\nTTS character/token limit.\n\nFree-tier truncation.\n\nPayload size limit.\n\nStreaming timeout.\n\nRequired Fix:\n\nIf meditation script exceeds TTS provider limit:\n\nSplit script into smaller chunks (max 700‚Äì800 characters each).\n\nGenerate audio sequentially per chunk.\n\nMerge audio chunks into one continuous file before playback.\n\nEnsure no abrupt audio cut between segments.\n\nIf merging is not supported:\n\nFallback Option:\n\nReduce meditation script length to fit within safe TTS limit (~90 seconds).\n\nOR disable voiceover temporarily and use ambient-only mode.\n\nüßò Architectural Requirements\n\nAmbient audio must not be tied to timer state updates.\n\nTimer updates must not re-render audio element.\n\nAudio element must initialize once per session.\n\nAvoid conditional rendering that destroys audio instance.\n\nHandle play() promise errors gracefully.\n\nLog clear error messages if TTS fails.\n\nüéØ Stability Priority Order\n\nIf full solution is not feasible, prioritize in this order:\n\nStable ambient playback.\n\nStable timer.\n\nMeditation script display.\n\nVoiceover (only if reliable).\n\nDo not allow partial voice playback to degrade user experience.\n\nü™µ Optional Enhancement (If System Allows)\n\nUse audio ended event to trigger session completion.\n\nPreload next audio chunk before current finishes (for smoother chunked TTS).\n\nMaintain one persistent audio controller for session.\n\nüéß Desired End State\n\nUser presses \"Start Session\":\n\nAmbient fades in.\n\nVoice plays fully without cutting.\n\nTimer runs without interrupting audio.\n\nAt completion:\n\nAmbient fades out.\n\nTransition to feedback screen.",
      "Create a long-form meditation voiceover system.\n\nRequirements:\n\nThe full meditation script must be read completely without stopping early.\n\nIf the script exceeds any TTS length limits, automatically split it into multiple chunks and queue them sequentially.\n\nEnsure audio playback waits until the full audio buffer is ready before playing.\n\nDo not use preview mode or short-response mode.\n\nUse high-quality long-form TTS.\n\nAdd console logs for debugging playback duration and errors.\n\nThe meditation should play fully even if it is longer than 2 minutes. - dont touch the ambient audio prompt its good",
      "1. Risk Flag Handling\n\nIf risk_flag returns no response or null, do NOT throw an error.\n\nContinue execution normally.\n\nOnly interrupt the flow if risk_flag explicitly returns a high-risk value.\n\nLog missing risk_flag response but do not stop processing.\n\n2. Script Generation\n\nGenerate one continuous meditation script of approximately 5 minutes.\n\nThe script must be written as one uninterrupted narrative.\n\nDo NOT restart tone or greeting in between segments.\n\nDo NOT repeat introductions like \"Take a deep breath\" again unless contextually natural.\n\nThe text must flow naturally from start to finish.\n\n3. Text Segmentation\n\nAutomatically split the script into 7 segments.\n\nEach segment must fit within 44 seconds of speech.\n\nSegments must be sequential parts of the SAME continuous script.\n\nDo NOT regenerate text per segment.\n\nDo NOT summarize.\n\nSimply divide the original script into consecutive chunks.\n\n4. TTS Nodes\n\nCreate 7 separate TTS audio nodes.\n\nEach TTS node receives exactly one sequential chunk.\n\nEach node should output an audio file.\n\nDo not truncate text.\n\n5. Audio Playback\n\nCreate an audio queue system:\n\nPlay TTS_1\n\nWhen finished ‚Üí play TTS_2\n\nContinue sequentially until TTS_7\n\nDo not overlap voice tracks.\n\nAmbient music must:\n\nStart before TTS_1\n\nLoop continuously\n\nPlay at 30% volume\n\nNever stop when voice transitions between segments\n\n6. Stability Rules\n\nIf any single TTS node fails:\n\nLog the error\n\nContinue playing remaining nodes\n\nDo not crash entire flow because of one segment failure."
    ],
    "raw_intent": "Please build this app - call it Aeri  following are your instruction - üß† GLOBAL SYSTEM INSTRUCTION (Use in All Gemini Nodes)\n\nAdd this as a base instruction where possible:\n\nThis application supports emotional regulation through reflection and guided meditation.\nIt is not therapy and must not provide medical advice.\nTone must always be calm, grounded, non-judgmental, and secular.\nIf user input indicates self-harm or crisis intent, set risk_flag accordingly and avoid generating meditation.\n\n1Ô∏è‚É£ NODE: Mood Classification Engine\nSystem Prompt\nYou are an emotional classification engine.\n\nAnalyze the user's input and return ONLY valid JSON.\n\nDo not include explanations.\n\nReturn this structure exactly:\n\n{\n  \"mood_label\": \"\",\n  \"trigger\": \"\",\n  \"emotional_tone\": \"\",\n  \"intensity_inferred\": 1-10,\n  \"risk_flag\": \"none | self_harm | crisis\"\n}\n\nRules:\n- mood_label must be 1‚Äì3 words.\n- trigger must summarize root cause in under 8 words.\n- emotional_tone describes internal pattern (e.g., self-critical, pressured, restless).\n- intensity_inferred must consider text and slider input.\n- If user expresses desire to harm themselves, set risk_flag = self_harm.\n- If user expresses urgent suicidal intent, set risk_flag = crisis.\n- If no risk detected, risk_flag = none.\n\nReturn only JSON.\n\nInput Variables Passed from Opal:\n\nmood_chip\n\nslider_intensity\n\nuser_text\n\n2Ô∏è‚É£ NODE: Reflection Question Generator\nSystem Prompt\nGenerate exactly 2 reflective questions.\n\nContext:\nMood: {mood_label}\nTrigger: {trigger}\nTone: {emotional_tone}\n\nRules:\n- Each question under 20 words.\n- Neutral and non-judgmental.\n- Encourage awareness, not advice.\n- No therapy terminology.\n- No spiritual language.\n- No motivational tone.\n\nOutput format:\n\n1. \n2.\n\n3Ô∏è‚É£ NODE: Meditation Generator (Core Engine)\nSystem Prompt\nYou are a professional secular meditation guide.\n\nCreate a 5-minute guided meditation.\n\nContext:\nMood: {mood_label}\nTrigger: {trigger}\nTone: {emotional_tone}\nUser Personalization Profile: {customization_profile}\n\nSTRICT STRUCTURE:\n\n1. Arrival and grounding\n2. Body awareness\n3. Breath focus\n4. Emotional acknowledgment\n5. Gentle reframing\n6. Closure and return to task\n\nRequirements:\n- 600‚Äì700 words maximum.\n- Tone: calm, warm, grounded.\n- No religion.\n- No philosophy.\n- No therapy jargon.\n- Do not analyze the user.\n- Do not give advice.\n- Do not mention psychology terms.\n- Include [pause 4 seconds] every 2‚Äì3 sentences.\n- If personalization profile suggests preferences, adapt tone and pacing naturally.\n- Keep language simple and human.\n\nOutput meditation script only.\n\n4Ô∏è‚É£ NODE: Post-Session Feedback Analyzer\n\nAfter user selects:\n\nVery helpful\n\nHelpful\n\nNeutral\n\nNot helpful\n\nIf NOT helpful ‚Üí run this node.\n\nSystem Prompt\nUser feedback: {feedback_rating}\nUser optional comment: {feedback_text}\n\nGenerate:\n1 short clarifying question under 15 words.\n\nPurpose:\nUnderstand why the meditation was not helpful.\n\nKeep tone neutral and calm.\nNo defensive language.\nNo therapy tone.\n\n5Ô∏è‚É£ NODE: AI Personalization Engine (Fully AI-Inferred)\n\nThis is critical.\n\nEvery session, after feedback, update user profile.\n\nSystem Prompt\nYou are updating a user's meditation personalization profile.\n\nPrevious profile:\n{customization_profile}\n\nCurrent session data:\nMood: {mood_label}\nTrigger: {trigger}\nFeedback rating: {feedback_rating}\nFeedback explanation: {feedback_text}\n\nUpdate the profile to better tailor future meditations.\n\nReturn ONLY valid JSON in this format:\n\n{\n  \"tone_preference\": \"direct | warm | softer\",\n  \"intro_length\": \"short | medium | long\",\n  \"body_focus\": \"minimal | balanced | extended\",\n  \"breath_focus\": \"minimal | balanced | extended\",\n  \"pacing\": \"slower | balanced | slightly_faster\",\n  \"notes\": \"short summary under 20 words\"\n}\n\nRules:\n- Infer gently from feedback.\n- Do not overcorrect from one session.\n- Evolve gradually.\n- If insufficient feedback, retain previous settings.\n- Keep adjustments subtle.\n- Return only JSON.\n\n\nThis is where the system becomes intelligent.\n\n6Ô∏è‚É£ NODE: Safety Intervention Script\n\nTriggered if risk_flag != none\n\nSystem Prompt\nUser input indicates potential self-harm or crisis.\n\nGenerate a short supportive message.\n\nRules:\n- Be compassionate.\n- Encourage seeking real human support.\n- Do not provide advice.\n- Do not minimize their feelings.\n- Do not generate meditation.\n- Keep under 120 words.\n\n\nThen manually append crisis resources in UI.\n\nüß© FINAL OPAL NODE ORDER\n\nLogin (Google handled by Opal)\n\nMood Input\n\nTranscription\n\nMood Classification\n\nSafety Check Branch\n\nReflection Generator\n\nMeditation Generator\n\nTTS (optional)\n\nPost Mood Check\n\nFeedback Analyzer\n\nPersonalization Engine\n\nStore Data\n\nUpdate Dashboard\n\nüìä Dashboard V1 Metrics\n\nDisplay:\n\nTotal Sessions\n\nAvg Mood Improvement\n\nMost Frequent Mood\n\nThis Week Usage Count\n\nSimple.\n\nüöÄ V1 IS NOW LOCKED\n\nYou now have:\n\n‚úî Clean architecture\n‚úî AI-driven personalization\n‚úî Structured prompts\n‚úî Safety logic\n‚úî Dashboard\n‚úî Adaptive evolution",
    "parameters": {}
  },
  "url": "drive:/1w1AUriqow1B3lEXRYaY7THK35wjecv6n",
  "assets": {},
  "title": "Aeri",
  "description": "Support emotional regulation through reflection and guided meditation.",
  "version": "0.0.1",
  "nodes": [
    {
      "id": "node_step_mood_analysis",
      "metadata": {
        "title": "Mood Classification",
        "visual": {
          "x": 680,
          "y": 300,
          "collapsed": "expanded",
          "outputHeight": 88
        },
        "step_intent": "Analyze the user's 'mood_chip', 'slider_intensity', and 'user_text' to classify their emotional state. Output must be a JSON object with: 'mood_label', 'trigger', 'emotional_tone', 'intensity_inferred', and 'risk_flag'. RISK HANDLING: If risk_flag returns no response or is null, do NOT throw an error; continue execution normally. Log the missing risk_flag response but do not stop processing. Only interrupt the flow if risk_flag explicitly returns a high-risk value (e.g., 'self_harm' or 'crisis')."
      },
      "type": "embed://a2/generate.bgl.json#module:main",
      "configuration": {
        "config$prompt": {
          "parts": [
            {
              "text": "## Objective\nThe objective is to analyze a user's emotional state by synthesizing three specific inputs‚Äîa mood selection, an intensity value, and a text description‚Äîto produce a structured emotional classification and risk assessment.\n\n## Task Definition\nTo achieve this objective, you will perform the following steps:\n1.  **Analyze Inputs:** Evaluate the combination of the user's selected mood ({{\"type\":\"in\",\"path\":\"ask_user_mood_chip\",\"title\":\"Mood Chip\"}}), the self-reported intensity level ({{\"type\":\"in\",\"path\":\"ask_user_slider_intensity\",\"title\":\"Slider Intensity\"}}), and the qualitative context provided in their message ({{\"type\":\"in\",\"path\":\"ask_user_user_text\",\"title\":\"User Text\"}}).\n2.  **Classify Emotional State:** Determine the primary `mood_label` and the underlying `emotional_tone`.\n3.  **Identify Triggers:** Extract the specific event, thought, or situation described in the text that elicited the emotional response.\n4.  **Infer Intensity:** Compare the `slider_intensity` with the linguistic cues in the `user_text` to provide a final `intensity_inferred`.\n5.  **Assess Risk:** Evaluate the text for indicators of crisis or self-harm.\n\n## Definitions and Specifications\nYou must adhere to the following logic and output structure:\n\n### JSON Output Fields\nThe final output must be a single JSON object containing these keys:\n- `mood_label`: The primary emotional category identified.\n- `trigger`: The specific cause or context identified from the text.\n- `emotional_tone`: The descriptive quality of the emotion (e.g., \"melancholic,\" \"volatile,\" \"peaceful\").\n- `intensity_inferred`: A refined intensity score or description based on the synthesis of all inputs.\n- `risk_flag`: A classification of risk level or specific risk type.\n\n### Risk Handling Protocol\n- **High-Risk Values:** If the `risk_flag` identifies explicit high-risk content (e.g., 'self_harm' or 'crisis'), you must flag this immediately.\n- **Missing/Null Risk Data:** If the risk assessment returns no specific response or is null, **DO NOT throw an error** and **DO NOT stop execution**. Continue the analysis normally.\n- **Logging:** In the event of a missing/null `risk_flag`, ensure the final JSON reflects this state without interrupting the processing flow.\n\n## Capabilities Usage\nUse the <function>generate_text</function> capability to perform the linguistic analysis of the user inputs and generate the final JSON classification. Your analysis should be grounded strictly in the provided input variables.\n\n## Requirements for the Ending Response\n- **Format:** The response MUST be a valid JSON object.\n- **Constraints:** Do NOT include any \"thinking aloud\" process, preamble, or markdown formatting tags (like ```json) in the final response. Output only the raw JSON string.\n- **Tone:** The inferred values should be clinical yet empathetic in their classification.\n- **Verifiability:** Every field in the JSON must be derived from the relationship between {{\"type\":\"in\",\"path\":\"ask_user_mood_chip\",\"title\":\"Mood Chip\"}}, {{\"type\":\"in\",\"path\":\"ask_user_slider_intensity\",\"title\":\"Slider Intensity\"}}, and {{\"type\":\"in\",\"path\":\"ask_user_user_text\",\"title\":\"User Text\"}}.\n\n## Execution and Output Reminder\nTake a deep breath and carefully read all instructions and inputs. Think step-by-step about how to solve this task. Use your built-in capabilities as needed to gather information and create the required outputs. Ensure your final response meets all format constraints and requirements before outputting it. Output your response as a JSON object."
            }
          ],
          "role": "user"
        },
        "generation-mode": "text"
      }
    },
    {
      "id": "node_step_ambient_audio_prompt",
      "metadata": {
        "title": "Ambient Audio Prompt Generation",
        "visual": {
          "x": 680,
          "y": 680,
          "collapsed": "expanded",
          "outputHeight": 88
        },
        "step_intent": "Generate a prompt for a single 5-minute continuous ambient meditation track. Description: '5-minute warm earthy ambient soundscape. Soft atmospheric pad with low warm drone. Gentle airy texture. Calm, grounded, spacious mood. No percussion. Meditative and stable.'"
      },
      "type": "embed://a2/generate.bgl.json#module:main",
      "configuration": {
        "config$prompt": {
          "parts": [
            {
              "text": "## Objective\nThe objective is to generate a highly detailed, optimized text prompt that can be used with a music generation AI to produce a high-quality, 5-minute continuous ambient meditation track. The resulting prompt must translate a basic conceptual description into specific technical and atmospheric instructions for an AI music model.\n\n## Task Definition\n1.  **Analyze Input**: Process the core requirements provided in `{{\"type\":\"in\",\"path\":\"meditation_description\",\"title\":\"Meditation Description\"}}`.\n2.  **Synthesis**: Use the `<function>generate_text</function>` to expand the base description into a comprehensive prompt.\n3.  **Incorporate Requirements**: Ensure the synthesized prompt explicitly includes:\n    *   **Duration**: Exactly 5 minutes of continuous audio.\n    *   **Instrumentation**: Soft atmospheric pads and low warm drones.\n    *   **Texture**: Airy and gentle textures.\n    *   **Mood/Atmosphere**: Calm, grounded, spacious, and meditative.\n    *   **Exclusion**: Explicitly state \"No percussion\" and \"No drums.\"\n    *   **Structure**: Stable and consistent throughout, avoiding abrupt transitions or sudden changes in volume/intensity.\n4.  **Final Output**: Present the final synthesized music prompt as the ending response.\n\n## Definitions and Specifications\n*   **Ambient Soundscape**: An immersive audio environment focused on tone and atmosphere rather than traditional rhythmic or melodic structures.\n*   **Warm Drone**: A sustained, low-frequency sound that provides a sense of grounding and stability, characterized by pleasant harmonic overtones rather than harsh or metallic sounds.\n*   **Atmospheric Pad**: A synthesized sound used to create deep tonal backgrounds, often with slow attack and release times to maintain a \"cloud-like\" presence.\n*   **Meditative and Stable**: Refers to a state of sonic consistency that facilitates deep breathing and focus, requiring a lack of distracting elements or rhythmic complexity.\n\n## Capabilities Usage\nYou must use the `<function>generate_text</function>` capability to formulate the final music generation prompt. Your request to the tool should include the specific descriptors from `{{\"type\":\"in\",\"path\":\"meditation_description\",\"title\":\"Meditation Description\"}}` and the requirement to format it into a professional-grade prompt for an AI music model. Base your final response on the output provided by the tool.\n\n## Requirements for the Ending Response\n*   **Output Format**: The response must be provided as **plain text** only.\n*   **No Metadata**: Do not include XML tags, headers, labels, or explanations (e.g., do not say \"Here is your prompt\").\n*   **Implicit Thinking**: Do not include any of your internal thinking process or reasoning steps in the output.\n*   **Tone**: The final prompt should be professional and descriptive.\n*   **Constraints**: The response must strictly adhere to the \"No percussion\" and \"5-minute\" duration requirements.\n\n## Execution and Output Reminder\nTake a deep breath and carefully read all instructions and inputs. Think step-by-step about how to solve this task. Use your built-in capabilities (search, content generation, file system access) as needed to gather information and create the required outputs. Ensure your final response meets all format constraints and requirements before outputting it. Use `<function>generate_text</function>` to craft the final string based on the provided `{{\"type\":\"in\",\"path\":\"meditation_description\",\"title\":\"Meditation Description\"}}`."
            }
          ],
          "role": "user"
        },
        "generation-mode": "text"
      }
    },
    {
      "id": "node_step_generate_ambient_background",
      "metadata": {
        "title": "Generate Continuous Ambient Background",
        "visual": {
          "x": 1050,
          "y": 350,
          "collapsed": "expanded",
          "outputHeight": 88
        },
        "step_intent": "Generate a single ambient background audio track based on the ambient_prompt."
      },
      "type": "embed://a2/generate.bgl.json#module:main",
      "configuration": {
        "config$prompt": {
          "parts": [
            {
              "text": "## Objective\nThe objective of this task is to generate a single, high-quality ambient background audio track that accurately reflects the atmospheric and stylistic details provided in a user prompt.\n\n## Task Definition\n1. **Analyze Input**: Carefully examine the `{{\"type\":\"in\",\"path\":\"node_step_ambient_audio_prompt\",\"title\":\"Ambient Audio Prompt Generation\"}}` to identify the intended mood, textures, instruments, and environmental sounds.\n2. **Generate Audio**: Use the specified music generation tool to create an audio track based on the extracted descriptions.\n3. **Verify Output**: Ensure the generated content aligns with the \"ambient\" genre‚Äîfocusing on atmosphere and background presence rather than complex melodic leads or aggressive rhythms.\n4. **Final Response**: Provide a clear confirmation to the user that the audio track has been successfully generated.\n\n## Definitions and Specifications\n* **Ambient Background Audio**: A genre of music that emphasizes tone and atmosphere over traditional musical structure or rhythm. It is designed to be unobtrusive and evocative of a specific setting or emotion.\n* **Input Variable**: \n    * `{{\"type\":\"in\",\"path\":\"node_step_ambient_audio_prompt\",\"title\":\"Ambient Audio Prompt Generation\"}}`: A text-based description provided by the user describing the desired soundscape (e.g., \"rainy forest at night with soft synth pads\" or \"ethereal space drone\").\n\n## Capabilities Usage\nYou MUST use the <function>generate_music_from_text</function> capability to complete this task. \n- When calling the tool, translate the descriptions in `{{\"type\":\"in\",\"path\":\"node_step_ambient_audio_prompt\",\"title\":\"Ambient Audio Prompt Generation\"}}` into parameters for style, mood, and tempo.\n- Ensure the tool is invoked correctly to produce the final audio file.\n\n## Requirements for the Ending Response\n* **Format**: Output your final response as plain text. Do NOT use XML tags or markdown formatting in the final message to the user.\n* **Content**: State clearly that the ambient background audio track has been generated based on the provided prompt. \n* **Constraint**: Do not include any technical logs or internal tool execution details in the final response.\n\n## Execution and Output Reminder\nTake a deep breath and carefully read all instructions and inputs. Think step-by-step about how to solve this task. Use your built-in capabilities (specifically music generation) to create the required output. Ensure your final response meets all format constraints and requirements before outputting it. Note: You must think implicitly; do NOT include your internal thinking process or \"thinking aloud\" in the final response."
            }
          ],
          "role": "user"
        },
        "generation-mode": "music"
      }
    },
    {
      "id": "node_step_generate_long_form_meditation_script",
      "metadata": {
        "title": "Generate Long-Form Guided Meditation Script",
        "visual": {
          "x": 1050,
          "y": 700,
          "collapsed": "expanded",
          "outputHeight": 88
        },
        "step_intent": "Generate ONE continuous meditation script of approximately 5 minutes (around 700-750 words). The script must be written as one uninterrupted narrative. Do NOT restart tone or greeting in between segments. Do NOT repeat introductions like 'Take a deep breath' unless contextually natural. The text must flow naturally from start to finish, following arrival, grounding, breath focus, emotional acknowledgment, and closure. Tone: calm, warm, and grounded. This script is generated only if risk_flag is not high-risk.",
        "userModified": false
      },
      "type": "embed://a2/generate.bgl.json#module:main",
      "configuration": {
        "config$prompt": {
          "role": "user",
          "parts": [
            {
              "text": "## Objective\nThe objective is to generate a single, continuous meditation script of approximately 5 minutes in length (700-750 words) based on the user's current mood. The script must be a seamless, uninterrupted narrative designed to guide a listener through a complete meditative journey from arrival to closure.\n\n## Task Definition\n1. **Analyze Mood**: Examine the provided `{{\"type\":\"in\",\"path\":\"node_step_mood_analysis\",\"title\":\"Mood Classification\"}}` to understand the user's emotional state and determine if there are high-risk indicators.\n2. **Safety Check**: \n    - If the `mood_analysis` indicates a high-risk situation, you MUST NOT generate the meditation script. Instead, provide a brief, supportive message recommending professional help.\n    - If the risk level is acceptable, proceed with script generation.\n3. **Generate Script**: Use the `<function>generate_text</function>` capability to draft a meditation script that follows this specific structural flow:\n    - **Arrival**: Inviting the listener into the space.\n    - **Grounding**: Connecting with the physical environment.\n    - **Breath Focus**: Establishing a steady, calming rhythm.\n    - **Emotional Acknowledgment**: Specifically addressing the themes found in the `{{\"type\":\"in\",\"path\":\"node_step_mood_analysis\",\"title\":\"Mood Classification\"}}` with empathy.\n    - **Closure**: Bringing the practice to a gentle and grounded end.\n4. **Narrative Review**: Ensure the script is one continuous piece of text. Remove any segment markers, headers, or redundant greetings.\n\n## Definitions and Specifications\n- **Length**: The script must be between 700 and 750 words. This is critical to ensure the pacing matches a 5-minute session.\n- **Narrative Style**: The text must be one uninterrupted narrative. Do NOT restart the tone or greeting in between sections.\n- **Tone**: Maintain a calm, warm, and grounded tone throughout the entire script.\n- **Natural Flow**: Do NOT repeat introductory phrases (like \"Take a deep breath\") unless it occurs naturally within the context of the guiding narrative. The transition between emotional acknowledgment and closure must feel fluid.\n- **Constraint**: Only generate the script if the risk assessment based on `{{\"type\":\"in\",\"path\":\"node_step_mood_analysis\",\"title\":\"Mood Classification\"}}` is not high-risk.\n\n## Capabilities Usage\nYou must use the `<function>generate_text</function>` to create the content of the meditation script. Ensure your instructions to the generation tool include the word count requirements, the specific mood context from the input, and the narrative flow constraints.\n\n## Requirements for the Ending Response\n- **Output Format**: Output your response as plain text without any XML tags, markdown headers (like # or ##), or special structural formatting.\n- **Content**: If safe to generate, the response should contain ONLY the meditation script text. If the risk is high, the response should contain only the safety/referral message.\n- **Verification**: Ensure the script word count falls within the 700-750 range before final output.\n\n## Execution and Output Reminder\nTake a deep breath and carefully read all instructions and inputs. Think step-by-step about how to solve this task. Use your built-in capabilities (specifically `<function>generate_text</function>`) as needed to create the required meditation script based on the mood analysis. Ensure your final response meets all format constraints and narrative requirements before outputting it."
            }
          ]
        },
        "generation-mode": "text-3-pro",
        "b-system-instruction": {
          "role": "user",
          "parts": [
            {
              "text": "You are working as part of an AI system, so no chit-chat and no explaining what you're doing and why.\nDO NOT start with \"Okay\", or \"Alright\" or any preambles. Just the output, please."
            }
          ]
        },
        "config$ask-user": false
      }
    },
    {
      "id": "node_step_script_segments",
      "metadata": {
        "title": "Text Segmentation For TTS",
        "visual": {
          "x": 1400,
          "y": 350,
          "collapsed": "expanded",
          "outputHeight": 88
        },
        "step_intent": "Automatically split the 'meditation_script' into exactly 7 sequential chunks. Each segment must fit within 44 seconds of speech (approx 100-110 words). Segments must be consecutive parts of the SAME continuous script. Do NOT regenerate or summarize. Set is_list_output=True to pass these 7 chunks to the TTS engine individually."
      },
      "type": "embed://a2/generate.bgl.json#module:main",
      "configuration": {
        "config$prompt": {
          "parts": [
            {
              "text": "## Objective\nThe objective is to accurately partition a provided meditation script into exactly seven sequential, verbatim chunks. Each chunk must be optimized for a text-to-speech (TTS) engine, ensuring the word count aligns with a specific timing constraint of approximately 44 seconds per segment.\n\n## Task Definition\n1. **Analyze Input:** Review the provided `{{\"type\":\"in\",\"path\":\"node_step_generate_long_form_meditation_script\",\"title\":\"Generate Long-Form Guided Meditation Script\"}}` to understand its total length and flow.\n2. **Segment Script:** Divide the script into exactly seven (7) consecutive segments.\n3. **Ensure Continuity:** Each segment must pick up exactly where the previous one ended, maintaining the integrity of the continuous script.\n4. **Constraint Adherence:** \n    - Do NOT summarize or paraphrase the text.\n    - Do NOT omit any parts of the original script.\n    - Do NOT regenerate the content; the output must be the original text, only partitioned.\n5. **Optimize for Timing:** Target a word count of approximately 100-110 words per chunk to ensure each segment fits within a 44-second speech window.\n6. **Tool Execution:** Use the suggested tool to process the text and generate the structured segments.\n\n## Definitions and Specifications\n- **Exactly 7 Chunks:** The output must contain no more and no fewer than 7 distinct parts.\n- **Sequentiality:** The chunks must be ordered (1 through 7) as they appear in the original script.\n- **TTS Optimization:** The target word count is 100-110 words per chunk. This is the primary metric for ensuring a playback time of ~44 seconds.\n- **is_list_output=True:** This instruction indicates that the resulting chunks are intended to be passed to a TTS engine individually as a list of items.\n\n## Capabilities Usage\nUse the <function>generate_text</function> capability to perform the linguistic analysis and segmentation of the `{{\"type\":\"in\",\"path\":\"node_step_generate_long_form_meditation_script\",\"title\":\"Generate Long-Form Guided Meditation Script\"}}`. Ensure the tool call focuses on the verbatim extraction of the seven segments based on the word count constraints provided.\n\n## Requirements for the Ending Response\nThe final response must be provided in a structured XML format to facilitate individual processing of each chunk by the TTS engine.\n\n- **Format:** Use the following XML structure:\n```xml\n<chunks>\n  <chunk_1>[Text of segment 1]</chunk_1>\n  <chunk_2>[Text of segment 2]</chunk_2>\n  <chunk_3>[Text of segment 3]</chunk_3>\n  <chunk_4>[Text of segment 4]</chunk_4>\n  <chunk_5>[Text of segment 5]</chunk_5>\n  <chunk_6>[Text of segment 6]</chunk_6>\n  <chunk_7>[Text of segment 7]</chunk_7>\n</chunks>\n```\n- **Strict Constraints:** \n    - Output ONLY the XML.\n    - Do NOT include any introductory text, concluding remarks, or explanations.\n    - Do NOT include your internal thinking process or scratchpad in the final output.\n    - Ensure the text within the tags is verbatim from the source.\n\n## Execution and Output Reminder\nTake a deep breath and carefully read all instructions and inputs. Think step-by-step about how to solve this task. Use your built-in capabilities (search, content generation, file system access) as needed to gather information and create the required outputs. Ensure your final response meets all format constraints and requirements before outputting it."
            }
          ],
          "role": "user"
        },
        "generation-mode": "text",
        "config$list": true
      }
    },
    {
      "id": "node_step_generate_voice_narration_chunks",
      "metadata": {
        "title": "Generate High-Quality Voice Narration Chunks",
        "visual": {
          "x": 1750,
          "y": 350,
          "collapsed": "expanded",
          "outputHeight": 88
        },
        "step_intent": "Create 7 separate TTS audio nodes. Each node receives exactly one sequential chunk from script_segments. Do not truncate text. Each node outputs an audio file."
      },
      "type": "embed://a2/generate.bgl.json#module:main",
      "configuration": {
        "config$prompt": {
          "role": "user",
          "parts": [
            {
              "text": "## Objective\nThe objective of this task is to generate seven distinct audio files from a provided script. You will process exactly seven sequential segments from the input list, ensuring each segment is converted into its own Text-to-Speech (TTS) audio output without any text truncation.\n\n## Task Definition\nTo achieve the objective, follow these steps:\n1.  **Parse Input:** Access the list of text segments provided in {{\"type\":\"in\",\"path\":\"node_step_script_segments\",\"title\":\"Text Segmentation For TTS\"}}.\n2.  **Segment Selection:** Identify and isolate the first seven sequential chunks from the list.\n3.  **Sequential Processing:** For each of the seven chunks (acting as seven separate nodes):\n    *   Extract the full text of the chunk.\n    *   Verify that no part of the text is omitted or truncated.\n    *   Use the TTS capability to convert that specific chunk into an audio file.\n4.  **Verification:** Ensure that seven individual audio files have been successfully generated, one for each corresponding script segment.\n\n## Definitions and Specifications\n*   **TTS Audio Node:** A single logical operation that takes one text input and produces one audio file output.\n*   **script_segments:** A list of text strings provided as {{\"type\":\"in\",\"path\":\"node_step_script_segments\",\"title\":\"Text Segmentation For TTS\"}}.\n*   **Sequential Order:** The segments must be processed in the exact order they appear in the input list (Index 0 through Index 6).\n*   **No Truncation:** The entirety of the text within each segment MUST be used for audio generation. You are strictly forbidden from shortening or summarizing the text.\n\n## Capabilities Usage\nYou must use the following tool to complete this task:\n*   **Speech Generation:** Use `<function>generate_speech_from_text</function>` for each of the seven segments. \n    *   Input: The full text of the sequential segment.\n    *   Action: Call this tool once for each segment to create seven separate audio outputs.\n\n## Requirements for the Ending Response\nThe final output must confirm the completion of the 7 nodes and provide the details of the generated files.\n*   **Format:** Output your response in XML format.\n*   **Attributes:** The response must include the status of each node and a confirmation of non-truncation.\n*   **Structure:**\n```xml\n<tts_generation_report>\n  <status>COMPLETED</status>\n  <nodes_processed>7</nodes_processed>\n  <outputs>\n    <node index=\"1\">\n      <segment_preview>[First 20 characters of segment]</segment_preview>\n      <result>Audio file generated successfully</result>\n    </node>\n    <!-- Repeat for all 7 nodes -->\n  </outputs>\n  <truncation_check>PASSED: All segments processed in full.</truncation_check>\n</tts_generation_report>\n```\n\n## Execution and Output Reminder\nTake a deep breath and carefully read all instructions and inputs. Think step-by-step about how to solve this task. Use your built-in capabilities (specifically <function>generate_speech_from_text</function>) to create the required audio outputs. Ensure your final response meets all format constraints and requirements before outputting it. Do not include your internal thinking process in the final response."
            }
          ]
        },
        "generation-mode": "audio",
        "voice": "Male (English)"
      }
    },
    {
      "id": "node_step_reflective_questions",
      "metadata": {
        "title": "Generate Reflection Questions",
        "visual": {
          "x": 1180,
          "y": 960,
          "collapsed": "expanded",
          "outputHeight": 88
        },
        "step_intent": "Generate two neutral reflective questions based on mood_analysis. Each under 20 words."
      },
      "type": "embed://a2/generate.bgl.json#module:main",
      "configuration": {
        "config$prompt": {
          "parts": [
            {
              "text": "## Objective\nThe objective is to generate two neutral and reflective questions based on a provided mood analysis. These questions should encourage the user to explore their current emotional state or the context surrounding it without bias or judgment.\n\n## Task Definition\n1.  **Analyze Mood:** Carefully review the information provided in {{\"type\":\"in\",\"path\":\"node_step_mood_analysis\",\"title\":\"Mood Classification\"}} to understand the identified emotional state, triggers, or patterns.\n2.  **Generate Questions:** Use the <function>generate_text</function> capability to create two distinct questions.\n    *   The questions must be directly relevant to the themes found in the mood analysis.\n    *   The questions must be \"reflective,\" meaning they prompt the user to think deeply about their experience.\n    *   The questions must be \"neutral,\" avoiding any leading language that suggests the user should feel a certain way or that their current mood is \"good\" or \"bad.\"\n3.  **Apply Constraints:** Ensure that each generated question is strictly under 20 words in length.\n\n## Definitions and Specifications\n*   **Neutral Tone:** The language should be objective and non-judgmental. Avoid words with heavy positive or negative connotations (e.g., instead of \"Why are you so sad?\", use \"What factors are contributing to your current state?\").\n*   **Reflective Question:** A question that invites the respondent to look inward, consider their perspectives, or evaluate their feelings.\n*   **Word Count Constraint:** Each question must contain 19 words or fewer.\n\n## Capabilities Usage\nYou must use the <function>generate_text</function> capability to craft the reflective questions based on the content of {{\"type\":\"in\",\"path\":\"node_step_mood_analysis\",\"title\":\"Mood Classification\"}}. Your final response should be derived from the output of this tool.\n\n## Requirements for the Ending Response\n*   The final response must contain exactly two questions.\n*   The response should be formatted as plain text for direct human consumption.\n*   DO NOT include any XML tags, headers, or additional commentary in the final output.\n*   **Verifiable Attributes:**\n    *   Attribute 1: Two questions total.\n    *   Attribute 2: Each question is under 20 words.\n    *   Attribute 3: Tone is neutral and reflective.\n\n## Execution and Output Reminder\nTake a deep breath and carefully read all instructions and inputs. Think step-by-step about how to solve this task. Use your built-in capabilities (specifically <function>generate_text</function>) to gather information and create the required outputs. Ensure your final response meets all format constraints and requirements before outputting it."
            }
          ],
          "role": "user"
        },
        "generation-mode": "text"
      }
    },
    {
      "id": "node_step_safety_message",
      "metadata": {
        "title": "Generate Safety Intervention",
        "visual": {
          "x": 500,
          "y": 980,
          "collapsed": "expanded",
          "outputHeight": 88
        },
        "step_intent": "If risk_flag is explicitly high-risk, generate a compassionate message encouraging human support."
      },
      "type": "embed://a2/generate.bgl.json#module:main",
      "configuration": {
        "config$prompt": {
          "parts": [
            {
              "text": "## Objective\nYour objective is to evaluate user data for high-risk indicators and, when necessary, generate a compassionate, supportive message that encourages the user to seek professional human help. You will analyze the emotional state and content provided to ensure safety and provide empathetic intervention.\n\n## Task Definition\n1.  **Analyze Inputs:** Examine the provided {{\"type\":\"in\",\"path\":\"ask_user_user_text\",\"title\":\"User Text\"}} and the {{\"type\":\"in\",\"path\":\"node_step_mood_analysis\",\"title\":\"Mood Classification\"}}.\n2.  **Risk Assessment:** Determine if the combination of the user's text and the mood analysis indicates an \"explicitly high-risk\" situation.\n3.  **Generate Response:** \n    *   If the risk is identified as high-risk, you must use the <function>generate_text</function> capability to draft a response that is empathetic, non-judgmental, and provides a clear path toward human support.\n    *   If the risk is not high-risk, you should provide a brief acknowledgement that no intervention is required.\n4.  **Final Output:** Present the generated message or the status update as the final response.\n\n## Definitions and Specifications\n*   **Explicitly High-Risk:** This refers to any content or analysis suggesting suicidal ideation, intent to self-harm, severe psychological crisis, or immediate danger to the user or others.\n*   **Compassionate Message:** The generated message must:\n    *   Acknowledge the user's pain or distress with empathy.\n    *   Avoid clinical or robotic language.\n    *   Explicitly encourage reaching out to a human (e.g., a friend, therapist, or crisis hotline).\n    *   Be concise yet warm.\n\n## Capabilities Usage\nYou must use the following tool if a high-risk scenario is detected:\n*   **Text Generation:** Use <function>generate_text</function> to create the compassionate response. Your prompt to the tool should specify the need for an empathetic, supportive, and safety-oriented tone based on the context found in the inputs.\n\n## Requirements for the Ending Response\n*   If a high-risk intervention is generated: The final response must be the compassionate message as **plain text** for direct delivery to the user. Do not use XML tags, headers, or internal thought markers in this output.\n*   If no high-risk intervention is needed: The final response should be exactly: \"Risk level: Normal. No intervention required.\" as plain text.\n\n## Execution and Output Reminder\nTake a deep breath and carefully read all instructions and inputs. Think step-by-step about how to solve this task. Analyze the {{\"type\":\"in\",\"path\":\"ask_user_user_text\",\"title\":\"User Text\"}} and {{\"type\":\"in\",\"path\":\"node_step_mood_analysis\",\"title\":\"Mood Classification\"}} thoroughly for safety concerns. Use your built-in <function>generate_text</function> capability as needed to create the required intervention. Ensure your final response meets all format constraints and requirements before outputting it."
            }
          ],
          "role": "user"
        },
        "generation-mode": "text"
      }
    },
    {
      "id": "node_step_meditation_session",
      "metadata": {
        "title": "Render Stabilized Meditation Session",
        "visual": {
          "x": 1540,
          "y": 640,
          "collapsed": "expanded",
          "outputHeight": 88
        },
        "step_intent": "Aeri interface: linen background #F3EFE7, sand surfaces #E7DFD2, rounded corners 20px, muted olive accent #8C9A7A. AUDIO PLAYBACK SYSTEM: 1. AMBIENT MUSIC: Start looping ambient_music at 30% volume BEFORE TTS_1 begins. It must never stop when voice transitions. 2. AUDIO QUEUE: Create a queue for the 7 tts_nodes. Play them sequentially: TTS_1 -> TTS_2 -> ... -> TTS_7. 3. TRANSITIONS: When one TTS finishes, immediately play the next. Do not overlap voice tracks. 4. STABILITY: If any single TTS node fails, log the error and continue playing the remaining nodes. Do not crash the app. 5. RISK LOGIC: If risk_flag is high-risk, show safety_intervention. Otherwise, play meditation. 6. UI: Display reflection_questions, timer, breathing animation, and script view."
      },
      "type": "embed://a2/a2.bgl.json#module:render-outputs",
      "configuration": {
        "text": {
          "parts": [
            {
              "text": "The webpage should present a serene and calming experience, focusing on a guided meditation or a safety intervention.\n\n**Layout Organization:**\n\n1.  **Overall Page Structure**: The page utilizes a clean, centered layout. The `body` background is the linen color. A single, dominant main content container, styled with rounded corners and the sand surface color, will be horizontally and vertically centered on the page. This container will be responsive, expanding to fill available width on smaller screens and having a maximum width on larger screens for optimal readability.\n2.  **Conditional Content Display**:\n    *   **Safety Intervention**: If `risk_flag` is high-risk, the main content container will exclusively display the `safety_intervention` text. This text should be prominent, centered, and easy to read, with ample padding around it.\n    *   **Meditation Session**: Otherwise, the main content container will house the meditation UI elements, structured vertically.\n        *   **Breathing Animation**: Positioned prominently at the top of the meditation content area, centered. This will be a subtle, abstract visual cue for breathing.\n        *   **Timer**: Discreetly placed, perhaps above or alongside the breathing animation, providing a clear digital countdown or elapsed time.\n        *   **Script View**: Below the breathing animation and timer, a scrollable text area will display the `meditation_script`. The currently active segment (`tts_nodes`) should be visually highlighted to guide the user without distraction.\n        *   **Reflection Questions**: At the bottom of the meditation content, a dedicated section will clearly present the two `reflection_questions`. Each question should be distinct and well-spaced.\n3.  **Audio Playback System**: An invisible background audio player for `ambient_music` will loop continuously at 30% volume, starting before any TTS. A robust audio queue system will sequentially play the 7 `tts_nodes` without overlap, ensuring smooth transitions and continuing playback even if an individual TTS node fails. Minimal UI controls (e.g., overall session play/pause) can be included, but the focus is on seamless background operation.\n\n**Style Design Language:**\n\n*   **Visual Design Approach**: Modern, tranquil, and grounding. The design should evoke a sense of calm and natural comfort, with a soft, inviting aesthetic.\n*   **Aesthetic Goal**: Serene, Premium, Grounding.\n*   **Color Scheme**:\n    *   **Page Background**: `#F3EFE7` (linen).\n    *   **Main Content Surfaces**: `#E7DFD2` (sand) for the primary containers and cards.\n    *   **Accent Color**: `#8C9A7A` (muted olive) for highlights, active states, and subtle UI elements.\n    *   **Text Color**: A soft, dark charcoal or dark brown for primary text to ensure high readability against the sand background, complementing the earthy palette.\n*   **Typography**: Clean, modern sans-serif typeface for all text. Font sizes should be carefully chosen to create clear hierarchy (e.g., larger for questions, standard for script, subtle for timer) while maintaining readability across devices.\n*   **Spacing and Layout Principles**:\n    *   **Generous Whitespace**: Ample padding and margins around all elements and within containers to foster a sense of openness and calm, reducing visual clutter.\n    *   **Rounded Corners**: A consistent `border-radius: 20px` should be applied to the main content container, reflection question cards, and any other panel-like UI elements to reinforce the soft, inviting aesthetic.\n    *   **Responsive Design**: The design must be fully responsive, employing flexible layouts (e.g., CSS Flexbox or Grid) to adapt fluidly to various screen sizes (mobile, tablet, desktop) with a mobile-first approach. Elements should scale and reflow gracefully.\n\n**Component Guidelines:**\n\n*   **Main Content Container**: A single, prominent `div` acting as the central \"card\" for the experience, with `background-color: #E7DFD2` and `border-radius: 20px`.\n*   **Breathing Animation**: A subtle, non-distracting CSS-based animation (e.g., a pulsing circle or a gentle color fade) that visually expands and contracts, encouraging mindful breathing.\n*   **Timer**: A simple digital display, perhaps using a slightly bolder font weight.\n*   **Script View**: A scrollable `div` containing the `meditation_script`. The currently playing `tts_node` segment within the script should have a subtle background highlight or muted accent text color to indicate its active state.\n*   **Reflection Questions**: Displayed as two separate, well-padded text blocks or card-like elements.\n*   **Safety Intervention**: A centered `div` with prominent text styling, taking over the main content area when activated.\n\nambient_music: {{\"type\":\"in\",\"path\":\"node_step_generate_ambient_background\",\"title\":\"Generate Continuous Ambient Background\"}}\n\nmood_analysis: {{\"type\":\"in\",\"path\":\"node_step_mood_analysis\",\"title\":\"Mood Classification\"}}\n\nsafety_intervention: {{\"type\":\"in\",\"path\":\"node_step_safety_message\",\"title\":\"Generate Safety Intervention\"}}\n\ntts_nodes: {{\"type\":\"in\",\"path\":\"node_step_generate_voice_narration_chunks\",\"title\":\"Generate High-Quality Voice Narration Chunks\"}}\n\nslider_intensity: {{\"type\":\"in\",\"path\":\"ask_user_slider_intensity\",\"title\":\"Slider Intensity\"}}\n\nuser_text: {{\"type\":\"in\",\"path\":\"ask_user_user_text\",\"title\":\"User Text\"}}\n\nmeditation_script: {{\"type\":\"in\",\"path\":\"node_step_generate_long_form_meditation_script\",\"title\":\"Generate Long-Form Guided Meditation Script\"}}\n\nreflection_questions: {{\"type\":\"in\",\"path\":\"node_step_reflective_questions\",\"title\":\"Generate Reflection Questions\"}}\n\nmood_chip: {{\"type\":\"in\",\"path\":\"ask_user_mood_chip\",\"title\":\"Mood Chip\"}}"
            }
          ],
          "role": "user"
        },
        "b-system-instruction": {
          "parts": [
            {
              "text": "You are an AI Web Developer. Your task is to generate a single, self-contained HTML document for rendering in an iframe, based on user instructions and data.\n\n**Visual aesthetic:**\n    * Aesthetics are crucial. Make the page look amazing, especially on mobile.\n    * Respect any instructions on style, color palette, or reference examples provided by the user.\n    * **CRITICAL: Aim for premium, state-of-the-art designs. Avoid simple minimum viable products.**\n    * **Use Rich Aesthetics**: The USER should be wowed at first glance by the design. Use best practices in modern web design (e.g. vibrant colors, dark modes, glassmorphism, and dynamic animations) to create a stunning first impression. Failure to do this is UNACCEPTABLE.\n    * **Prioritize Visual Excellence**: Implement designs that will WOW the user and feel extremely premium:\n        - Avoid generic colors (plain red, blue, green). Use curated, harmonious color palettes (e.g., HSL tailored colors, sleek dark modes).\n        - Using modern typography (e.g., from Google Fonts like Inter, Roboto, or Outfit) instead of browser defaults.\n        - Use smooth gradients.\n        - Add subtle micro-animations for enhanced user experience.\n    * **Use a Dynamic Design**: An interface that feels responsive and alive encourages interaction. Achieve this with hover effects and interactive elements. Micro-animations, in particular, are highly effective for improving user engagement.\n    * **Thematic Specificity**: Do not just create a generic layout. Define a clear \"vibe\" or theme based on the content. Use specific aesthetic keywords (e.g., \"Glassmorphism\", \"Neobrutalism\", \"Minimalist\", \"Comic Book Style\") to guide the design.\n    * **Typography Hierarchy**: Explicitly import and use font pairings. Use a distinct Display Font for headers and a highly readable Body Font for text.\n    * **Readability**: Pay extra attention to readability. Ensure the text is always readable with sufficient contrast against the background. Choose fonts and colors that enhance legibility.\n\n**Design and Functionality:**\n    * **Component-Based Design**: Do not just dump text into blocks. Semanticize the content into distinct UI components.\n    * **Layout Dynamics**: Break the grid. Avoid strict, identical grid columns. Use asymmetrical layouts, Bento grids, or responsive flexbox layouts where some elements span full width to create visual interest and emphasize key content.\n    * **Tailwind Configuration**: Extend the Tailwind configuration within a `<script>` block to define custom font families and color palettes that match the theme.\n    * Thoroughly analyze the user's instructions to determine the desired type of webpage, application, or visualization. What are the key features, layouts, or functionality?\n    * Analyze any provided data to identify the most compelling layout or visualization of it. For example, if the user requests a visualization, select an appropriate chart type (bar, line, pie, scatter, etc.) to create the most insightful and visually compelling representation. Or if user instructions say `use a carousel format`, you should consider how to break the content and any media into different card components to display within the carousel.\n    * If requirements are underspecified, make reasonable assumptions to complete the design and functionality. Your goal is to deliver a working product with no placeholder content.\n    * Ensure the generated code is valid and functional. Return only the code, and open the HTML codeblock with the literal string \"```html\".\n    * The output must be a complete and valid HTML document with no placeholder content for the developer to fill in.\n\n**Libraries:**\n  Unless otherwise specified, use:\n    * Tailwind for CSS\n    * **CRITICAL: Use the Tailwind CDN from `https://cdn.tailwindcss.com`. Do NOT use `tailwind.min.css` or any other local Tailwind file. Always include Tailwind using: `<script src=\"https://cdn.tailwindcss.com\"></script>`**\n\n**Constraints:**\n  * **External Links:** You ARE allowed to generate external links (`<a href=\"...\">` and `window.open(...)`) to external websites (e.g. google.com, wikipedia.org) for user navigation.\n  * **NO External Embeds:** Do NOT embed any external resources (e.g. `<script src=\"...\">`, `<img src=\"...\">`, `<iframe src=\"...\">`, `<link href=\"...\">`) from external URLs. Content Security Policy (CSP) will block them.\n  * **Media Restriction:** ONLY use media URLs that are explicitly passed in the input. Do NOT generate or hallucinate any other media URLs (e.g. from placeholder sites or external CDNs).\n  * **Render All Media:** You MUST render ALL media (images, videos, audio) that are passed in. Do NOT skip or omit any provided media items. Every passed-in media URL must appear in the final HTML output.\n  * **Navigation Restriction:** Do NOT generate unneeded fake links or buttons to sub-pages (e.g. \"About\", \"Contact\", \"Learn More\") unless explicitly requested. Stick to the plan and the provided content.\n  * **Footer Restriction:** **NEVER** generate any footer content, including legal footers like \"All rights reserved\" or \"Copyright 2024\". [It is a violation of Google's policies to hallucinate legal footers.]\n"
            }
          ],
          "role": "user"
        },
        "p-render-mode": "Auto",
        "b-render-model-name": "gemini-flash"
      }
    },
    {
      "id": "ask_user_mood_chip",
      "metadata": {
        "title": "Mood Chip",
        "visual": {
          "x": 250,
          "y": 300,
          "collapsed": "expanded",
          "outputHeight": 88
        }
      },
      "type": "embed://a2/a2.bgl.json#21ee02e7-83fa-49d0-964c-0cab10eafc2c",
      "configuration": {
        "description": {
          "parts": [
            {
              "text": "Describe your current mood"
            }
          ],
          "role": "user"
        },
        "p-modality": "Any"
      }
    },
    {
      "id": "ask_user_slider_intensity",
      "metadata": {
        "title": "Slider Intensity",
        "visual": {
          "x": 250,
          "y": 450,
          "collapsed": "expanded",
          "outputHeight": 88
        }
      },
      "type": "embed://a2/a2.bgl.json#21ee02e7-83fa-49d0-964c-0cab10eafc2c",
      "configuration": {
        "description": {
          "parts": [
            {
              "text": "How strong is this mood?"
            }
          ],
          "role": "user"
        },
        "p-modality": "Any"
      }
    },
    {
      "id": "ask_user_user_text",
      "metadata": {
        "title": "User Text",
        "visual": {
          "x": 250,
          "y": 600,
          "collapsed": "expanded",
          "outputHeight": 88
        }
      },
      "type": "embed://a2/a2.bgl.json#21ee02e7-83fa-49d0-964c-0cab10eafc2c",
      "configuration": {
        "description": {
          "parts": [
            {
              "text": "Share more about how you feel"
            }
          ],
          "role": "user"
        },
        "p-modality": "Any"
      }
    }
  ],
  "edges": [
    {
      "from": "ask_user_mood_chip",
      "to": "node_step_mood_analysis",
      "out": "context",
      "in": "p-z-ask_user_mood_chip"
    },
    {
      "from": "ask_user_mood_chip",
      "to": "node_step_meditation_session",
      "out": "context",
      "in": "p-z-ask_user_mood_chip"
    },
    {
      "from": "ask_user_slider_intensity",
      "to": "node_step_mood_analysis",
      "out": "context",
      "in": "p-z-ask_user_slider_intensity"
    },
    {
      "from": "ask_user_slider_intensity",
      "to": "node_step_meditation_session",
      "out": "context",
      "in": "p-z-ask_user_slider_intensity"
    },
    {
      "from": "ask_user_user_text",
      "to": "node_step_mood_analysis",
      "out": "context",
      "in": "p-z-ask_user_user_text"
    },
    {
      "from": "ask_user_user_text",
      "to": "node_step_safety_message",
      "out": "context",
      "in": "p-z-ask_user_user_text"
    },
    {
      "from": "ask_user_user_text",
      "to": "node_step_meditation_session",
      "out": "context",
      "in": "p-z-ask_user_user_text"
    },
    {
      "from": "node_step_ambient_audio_prompt",
      "to": "node_step_generate_ambient_background",
      "out": "context",
      "in": "p-z-node_step_ambient_audio_prompt"
    },
    {
      "from": "node_step_mood_analysis",
      "to": "node_step_generate_long_form_meditation_script",
      "out": "context",
      "in": "p-z-node_step_mood_analysis"
    },
    {
      "from": "node_step_mood_analysis",
      "to": "node_step_reflective_questions",
      "out": "context",
      "in": "p-z-node_step_mood_analysis"
    },
    {
      "from": "node_step_mood_analysis",
      "to": "node_step_safety_message",
      "out": "context",
      "in": "p-z-node_step_mood_analysis"
    },
    {
      "from": "node_step_mood_analysis",
      "to": "node_step_meditation_session",
      "out": "context",
      "in": "p-z-node_step_mood_analysis"
    },
    {
      "from": "node_step_generate_long_form_meditation_script",
      "to": "node_step_script_segments",
      "out": "context",
      "in": "p-z-node_step_generate_long_form_meditation_script"
    },
    {
      "from": "node_step_generate_long_form_meditation_script",
      "to": "node_step_meditation_session",
      "out": "context",
      "in": "p-z-node_step_generate_long_form_meditation_script"
    },
    {
      "from": "node_step_script_segments",
      "to": "node_step_generate_voice_narration_chunks",
      "out": "context",
      "in": "p-z-node_step_script_segments"
    },
    {
      "from": "node_step_generate_ambient_background",
      "to": "node_step_meditation_session",
      "out": "context",
      "in": "p-z-node_step_generate_ambient_background"
    },
    {
      "from": "node_step_reflective_questions",
      "to": "node_step_meditation_session",
      "out": "context",
      "in": "p-z-node_step_reflective_questions"
    },
    {
      "from": "node_step_safety_message",
      "to": "node_step_meditation_session",
      "out": "context",
      "in": "p-z-node_step_safety_message"
    },
    {
      "from": "node_step_generate_voice_narration_chunks",
      "to": "node_step_meditation_session",
      "out": "context",
      "in": "p-z-node_step_generate_voice_narration_chunks"
    }
  ]
}
